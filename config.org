#+title: David Vogel's Clean Doom Emacs Config
#+author: David Vogel
#+date: <2025-11-25>
#+description: Minimal, fast, beautiful — built on Doom’s excellent defaults + one perfect bookmark template
#+property: header-args:elisp :tangle config.el :mkdirp yes
#+startup: overview

* Introduction
* Table of Contents                                             :toc:
- [[#introduction][Introduction]]
- [[#identity][Identity]]
- [[#fonts][Fonts]]
- [[#theme--ui][Theme & UI]]
- [[#general-behavior][General Behavior]]
- [[#performance--startup][Performance & Startup]]
- [[#completion-tweaks][Completion Tweaks]]
- [[#in-buffer-completion-company][In-Buffer Completion (Company)]]
- [[#org-mode--dooms-defaults--bookmark-capture][Org Mode — Doom’s defaults + bookmark capture]]
  - [[#daily-review--still-the-best-two-pane-workflow][Daily Review — still the best two-pane workflow]]
- [[#keybindings][Keybindings]]
  - [[#fixed-safer-binding-to-avoid-prefix-conflicts][FIXED: Safer binding to avoid prefix conflicts]]
- [[#system-integration][System Integration]]
  - [[#ssh-agent-via-gpg][SSH Agent via GPG]]
  - [[#final-touch][Final touch]]

* Identity
#+begin_src elisp
(setq user-full-name "David Vogel"
      user-mail-address "dvogelca@proton.me")
#+end_src

* Fonts
#+begin_src elisp
(setq doom-font (font-spec :family "Hasklug Nerd Font Mono" :size 16 :weight 'semi-light)
      doom-variable-pitch-font (font-spec :family "Alegreya" :size 18)
      doom-big-font (font-spec :family "Hasklug Nerd Font Mono" :size 22))
#+end_src

* Theme & UI
#+begin_src elisp
(setq doom-theme 'modus-vivendi-tinted)
(add-to-list 'default-frame-alist '(undecorated . t))
(set-frame-parameter (selected-frame) 'alpha '(96 . 97))
(add-to-list 'default-frame-alist '(alpha . (96 . 97)))

(setq doom-modeline-icon t
      doom-modeline-major-mode-icon t
      doom-modeline-lsp t
      doom-modeline-major-mode-color-icon t)

(use-package! golden-ratio
     :defer t
     :config
     (golden-ratio-mode 1)
     (set golden-ratio-adjust-factor 1.05 ))
(map! :leader
      :desc "Toggle golden-ratio" "t G" #'golden-ratio-mode)
#+end_src

* General Behavior
#+begin_src elisp
(setq display-line-numbers-type 'relative
      which-key-idle-delay 0.2
      delete-by-moving-to-trash t
      auto-save-default t
      browse-url-browser-function 'browse-url-generic
      browse-url-generic-program "zen-browser")
#+end_src

* Performance & Startup
#+begin_src elisp
(setq gc-cons-threshold (* 256 1024 1024)
      gc-cons-percentage 0.1
      read-process-output-max (* 4 1024 1024)
      native-comp-async-jobs 4
      comp-deferred-compilation t
      vc-handled-backends '(Git))
#+end_src

* Completion Tweaks
#+begin_src elisp
(after! vertico
  (setq vertico-count 17 vertico-resize t vertico-cycle t))

(after! orderless
  (setq completion-styles '(orderless basic)
        completion-category-overrides '((file (styles basic partial-completion orderless)))))

(after! consult
  (setq consult-preview-key "M-." consult-narrow-key "<"))

(after! marginalia
  (setq marginalia-align 'right))
#+end_src

* In-Buffer Completion (Company)
#+begin_src elisp
(after! company
  (setq company-idle-delay 0.2
        company-minimum-prefix-length 2
        company-show-quick-access t))
#+end_src

* Org Mode — Doom’s defaults + bookmark capture
We keep everything Doom gives us (pretty bullets, roam, refile, agenda, etc.) and add **one** excellent bookmark template.

#+begin_src elisp
(setq org-directory "~/org/"
      org-agenda-files '("~/org/")
      org-default-notes-file "~/org/inbox.org"
      org-roam-directory "~/org/notes")

;; One perfect bookmark capture template
;; Use `SPC n c b` → instantly saves URL + title + selection + timestamp
;; Works from anywhere (browser via bookmarklet, Emacs buffer, etc.)
(setq org-capture-templates
      '(("b" "Bookmark" entry
         (file+headline "~/org/bookmarks.org" "Inbox")
         "* [[%^{URL}][%^{Title}]]   :bookmark:\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?\n%i\n"
         :empty-lines 1
         :immediate-finish t)))

;; Optional: auto-create bookmarks.org if it doesn't exist (safe, idempotent)
(unless (file-exists-p "~/org/bookmarks.org")
  (with-temp-file "~/org/bookmarks.org"
    (insert "#+title: Web Bookmarks\n#+filetags: :bookmarks:\n\n* Inbox\n")))
#+end_src

** Daily Review — still the best two-pane workflow
#+begin_src elisp
(defun my/daily-review ()
  "Today’s agenda + inbox side-by-side."
  (interactive)
  (org-agenda nil "d")
  (delete-other-windows)
  (split-window-right)
  (find-file org-default-notes-file))
#+end_src

* Keybindings
Everything under =SPC n= (notes/workflow) — clean and discoverable.

** FIXED: Safer binding to avoid prefix conflicts
We use `general-def` to explicitly unbind/override any conflicting `n r` from Evil defaults, then bind safely.

#+begin_src elisp
(after! evil  ; Wait for Evil to load its defaults
  (general-def
    :states 'normal
    :keymaps 'override  ; Override any Doom/Evil defaults
    :prefix "SPC n"     ; Single-level prefix (no sub-nesting)
    "" 'which-key-show-major-mode  ; Show help for this prefix
    "a" '(org-agenda :wk "Org agenda")
    "c" '(org-capture :wk "Org capture")
    "b" '(lambda () (interactive) (org-capture nil "b") :wk "Capture bookmark")
    "i" '(lambda () (interactive) (find-file org-default-notes-file) :wk "Open inbox")
    "B" '(lambda () (interactive) (find-file "~/org/bookmarks.org") :wk "Open bookmarks")
    "d" '(my/daily-review :wk "Daily review")
    "f" '(org-roam-node-find :wk "Roam find")
    "r" '(org-roam-capture :wk "Roam capture"))  ; ← This overrides any conflicting "n r"
  ;; Explicitly clear any sub-prefix under "n r" if it exists from Evil
  (general-unbind
    :keymaps 'leader-minor-mode-keymap
    "n r"))
#+end_src

* System Integration
** SSH Agent via GPG
#+begin_src elisp
(setenv "SSH_AUTH_SOCK"
        (concat (or (getenv "XDG_RUNTIME_DIR")
                    (format "/run/user/%d" (user-uid)))
                "/gnupg/S.gpg-agent.ssh"))
#+end_src

** Final touch
#+begin_src elisp
(provide 'config)
;;; config.el ends here
#+end_src
